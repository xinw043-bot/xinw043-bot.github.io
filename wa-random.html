<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Connect on WhatsApp</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            background: white;
            padding: 40px 25px; /* 增加上下内边距，让卡片更舒展 */
            border-radius: 16px; /* 圆角稍微大一点，更现代 */
            box-shadow: 0 4px 20px rgba(0,0,0,0.08); /* 阴影更柔和 */
            max-width: 380px;
            width: 100%;
            text-align: center;
            box-sizing: border-box;
        }
        
        /* 头部图标 */
        .icon-svg { 
            margin-bottom: 30px; /* Logo 和按钮之间的距离 */
            filter: drop-shadow(0 2px 4px rgba(37, 211, 102, 0.2)); /* 给 Logo 加一点微光 */
        }
        
        /* 通用按钮样式 */
        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 16px 0;
            color: white;
            text-decoration: none;
            font-weight: 600; /* 字体加粗但不过分 */
            font-size: 17px;
            border-radius: 12px; /* 按钮圆角稍微方一点点，像 iOS 原生 */
            margin-bottom: 15px;
            cursor: pointer;
            border: none;
            -webkit-tap-highlight-color: transparent;
            transition: transform 0.1s, opacity 0.2s;
            line-height: 1.2;
        }
        .btn:active { transform: scale(0.98); opacity: 0.9; }

        /* 主按钮 (WhatsApp 绿) */
        .btn-primary { 
            background-color: #25D366; 
            box-shadow: 0 4px 10px rgba(37, 211, 102, 0.3);
        }

        /* 复制按钮 (Messenger 蓝) */
        .btn-copy { 
            background-color: #0084ff; 
            box-shadow: 0 4px 10px rgba(0, 132, 255, 0.3);
            margin-bottom: 0; /* 最后一个按钮不需要下边距 */
        }
        
        .loading { font-size: 14px; color: #888; margin-top: 10px; }
        
        /* 底部红色提示语 */
        .ios-hint-text {
            font-size: 13px;
            color: #d93025; 
            background-color: #fff5f5;
            padding: 12px;
            border-radius: 8px;
            margin-top: 25px; /* 与上方按钮拉开距离 */
            line-height: 1.5;
            text-align: left;
            display: none; /* 默认隐藏 */
            border: 1px solid #ffebeb;
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- WhatsApp 图标 -->
        <svg class="icon-svg" width="70" height="70" viewBox="0 0 24 24" fill="#25D366" xmlns="http://www.w3.org/2000/svg">
            <path d="M17.472 14.382C17.112 14.202 15.344 13.332 15.013 13.213C14.682 13.094 14.441 13.034 14.2 13.394C13.959 13.754 13.269 14.564 13.058 14.804C12.848 15.044 12.638 15.074 12.278 14.894C11.918 14.714 10.758 14.334 9.383 13.109C8.308 12.15 7.583 10.966 7.373 10.606C7.163 10.246 7.35 10.051 7.53 9.871C7.69 9.711 7.886 9.455 8.066 9.245C8.246 9.035 8.306 8.885 8.426 8.645C8.546 8.405 8.486 8.195 8.411 8.045C8.336 7.895 7.646 6.196 7.361 5.506C7.081 4.832 6.796 4.922 6.586 4.922C6.391 4.922 6.166 4.907 5.941 4.907C5.716 4.907 5.356 4.997 5.056 5.327C4.756 5.657 3.9 6.467 3.9 8.117C3.9 9.767 5.101 11.372 5.281 11.612C5.461 11.852 7.771 15.418 11.311 16.948C12.152 17.308 12.809 17.524 13.323 17.687C14.167 17.955 14.937 17.917 15.545 17.826C16.219 17.726 17.622 16.976 17.914 16.151C18.206 15.326 18.206 14.621 18.116 14.471C18.026 14.321 17.786 14.261 17.426 14.081H17.472Z" fill="white"/>
        </svg>

        <!-- 按钮 A: 直接打开 (绿色) -->
        <a id="wa-link" href="#" target="_blank" class="btn btn-primary">Open WhatsApp</a>
        
        <!-- 按钮 B: 复制账号 (蓝色 - 默认隐藏) -->
        <button id="copy-btn" class="btn btn-copy" style="display:none;" onclick="copyNumber()">
            Copy Sales WhatsApp
        </button>
        
        <!-- iOS 英文提示语 -->
        <div id="ios-hint" class="ios-hint-text">
            <b>Connection Issue?</b><br>
            If WhatsApp fails to open, please tap the blue button above to copy the number, then add it manually to continue our discussion.
        </div>

        <div id="loading-text" class="loading">Redirecting...</div>
    </div>

    <script>
    const waNumbers = ["8613890174417", "8619994654895", "8618923713151"];
    const apiUrl = "https://xinw043-bot-github-io.vercel.app/api/log"; 

    // 1. 锁定号码逻辑
    let finalNumber = localStorage.getItem('assigned_wa');
    if (!finalNumber) {
        finalNumber = waNumbers[Math.floor(Math.random() * waNumbers.length)];
        localStorage.setItem('assigned_wa', finalNumber);
    }

    const message = encodeURIComponent("Hi I want to inquire about thermal imaging cameras");
    
    // 2. 环境检测
    const ua = navigator.userAgent || navigator.vendor || window.opera;
    const isAndroid = /Android/i.test(ua);
    const isIOS = /iPhone|iPad|iPod/i.test(ua);
    
    // 3. 链接生成
    const androidLink = `whatsapp://send?phone=${finalNumber}&text=${message}`;
    const iosLink = `https://api.whatsapp.com/send?phone=${finalNumber}&text=${message}`; 
    const targetLink = isAndroid ? androidLink : iosLink;

    // 绑定主按钮
    const linkBtn = document.getElementById('wa-link');
    linkBtn.href = targetLink;

    // 4. 复制号码功能
    function copyNumber() {
        const tempInput = document.createElement("input");
        tempInput.value = "+" + finalNumber;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand("copy");
        document.body.removeChild(tempInput);
        
        // 按钮反馈
        const btn = document.getElementById('copy-btn');
        const originalText = btn.innerText;
        btn.innerText = "Copied! ✅";
        btn.style.backgroundColor = "#128C7E"; // 成功后变绿
        
        // 2秒后恢复
        setTimeout(() => {
            btn.innerText = "Copy Sales WhatsApp";
            btn.style.backgroundColor = "#0084ff";
        }, 2000);
    }

    window.onload = function() {
        // 发送日志
        const logData = { phoneNumber: finalNumber, redirectTime: new Date().toISOString() };
        fetch(apiUrl, {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(logData), keepalive: true 
        }).catch(console.error);

        // --- 逻辑分支 ---
        const loadingText = document.getElementById('loading-text');
        const copyBtn = document.getElementById('copy-btn');
        const iosHint = document.getElementById('ios-hint');

        if (isIOS) {
            // === iOS 环境 ===
            // 隐藏 Loading，因为我们不再自动跳转
            loadingText.style.display = 'none';
            
            // 显示复制按钮和提示
            copyBtn.style.display = 'flex';
            iosHint.style.display = 'block';
            
        } else if (isAndroid) {
            // === Android 环境 ===
            // 安卓继续尝试自动跳转
            setTimeout(() => { window.location.href = targetLink; }, 1000);
        } else {
            // === PC 环境 ===
            loadingText.style.display = 'none';
        }
    };
    </script>
</body>
</html>
