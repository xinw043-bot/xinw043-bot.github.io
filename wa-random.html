<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Connect on WhatsApp</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            background: white;
            padding: 40px 25px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            max-width: 380px;
            width: 100%;
            text-align: center;
            box-sizing: border-box;
        }
        
        /* 头部图标样式 */
        .icon-svg { 
            margin-bottom: 25px; 
            filter: drop-shadow(0 4px 6px rgba(37, 211, 102, 0.3)); /* 增加一点立体感 */
        }
        
        /* 通用按钮样式 */
        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 16px 0;
            color: white;
            text-decoration: none;
            font-weight: 600;
            font-size: 17px;
            border-radius: 12px;
            margin-bottom: 15px;
            cursor: pointer;
            border: none;
            -webkit-tap-highlight-color: transparent;
            transition: transform 0.1s, opacity 0.2s;
            line-height: 1.2;
        }
        .btn:active { transform: scale(0.98); opacity: 0.9; }

        /* 主按钮 (绿色) */
        .btn-primary { 
            background-color: #25D366; 
            box-shadow: 0 4px 10px rgba(37, 211, 102, 0.3);
        }

        /* 复制按钮 (Messenger 蓝) */
        .btn-copy { 
            background-color: #0084ff; 
            box-shadow: 0 4px 10px rgba(0, 132, 255, 0.3);
            margin-bottom: 0; 
        }
        
        .loading { font-size: 14px; color: #888; margin-top: 10px; }
        
        /* 底部提示语 (您要求的修改) */
        .ios-hint-text {
            font-size: 14px; /* 字体稍微调大一点点，更清晰 */
            color: #d93025; 
            background-color: #fff5f5;
            padding: 15px;
            border-radius: 8px;
            margin-top: 25px;
            line-height: 1.5;
            text-align: center; /* 居中对齐更好看 */
            display: none; 
            border: 1px solid #ffebeb;
            font-weight: 500;
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- 1. WhatsApp 官方 Logo (标准图标) -->
        <svg class="icon-svg" width="80" height="80" viewBox="0 0 24 24" fill="#25D366" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M18.403 5.633A8.919 8.919 0 0 0 12.053 3c-4.948 0-8.976 4.027-8.978 8.977 0 1.582.413 3.126 1.198 4.488L3 21.116l4.759-1.249a8.981 8.981 0 0 0 4.29 1.093h.004c4.947 0 8.975-4.027 8.977-8.977a8.926 8.926 0 0 0-2.627-6.35m-6.35 13.812h-.003a7.446 7.446 0 0 1-3.798-1.041l-.272-.162-2.824.741.753-2.753-.177-.282a7.448 7.448 0 0 1-1.141-3.971c.002-4.114 3.349-7.461 7.465-7.461a7.413 7.413 0 0 1 5.275 2.188 7.42 7.42 0 0 1 2.183 5.279c-.002 4.114-3.349 7.462-7.461 7.462m4.093-5.589c-.225-.113-1.327-.655-1.533-.73-.205-.075-.354-.112-.504.112-.15.224-.579.73-.71.88-.131.149-.262.168-.486.056-.224-.112-9.46-3.515-1.089-5.968.223-.111.432-.167.578-.167.126 0 .252 0 .373.003.111.002.261.041.396.115s.9 2.196 1.025 2.502c.038.094.02.179-.06.305" fill="#25D366"/>
             <!-- 这里的路径绘制的是空心部分，下面加一个白色背景层确保在任何背景下都好看 -->
             <path d="M12.053 21.5C17.3 21.5 21.5 17.3 21.5 12C21.5 6.7 17.3 2.5 12.053 2.5C6.8 2.5 2.6 6.7 2.6 12C2.6 17.3 6.8 21.5 12.053 21.5Z" fill="white" style="mix-blend-mode: destination-over;"/>
        </svg>

        <!-- 按钮 A: 直接打开 -->
        <a id="wa-link" href="#" target="_blank" class="btn btn-primary">Open WhatsApp</a>
        
        <!-- 按钮 B: 复制账号 -->
        <button id="copy-btn" class="btn btn-copy" style="display:none;" onclick="copyNumber()">
            Copy Sales WhatsApp ID
        </button>
        
        <!-- 2. 底部提示语 (iOS 专用) -->
        <div id="ios-hint" class="ios-hint-text">
            WhatsApp not opening? Copy the sales WhatsApp above and add manually to continue .
        </div>

        <div id="loading-text" class="loading">Redirecting...</div>
    </div>

    <script>
    const waNumbers = ["8613890174417", "8619994654895", "8618923713151"];
    const apiUrl = "https://xinw043-bot-github-io.vercel.app/api/log"; 

    // 锁定号码
    let finalNumber = localStorage.getItem('assigned_wa');
    if (!finalNumber) {
        finalNumber = waNumbers[Math.floor(Math.random() * waNumbers.length)];
        localStorage.setItem('assigned_wa', finalNumber);
    }

    const message = encodeURIComponent("Hi I want to inquire about thermal imaging cameras");
    
    // 环境检测
    const ua = navigator.userAgent || navigator.vendor || window.opera;
    const isAndroid = /Android/i.test(ua);
    const isIOS = /iPhone|iPad|iPod/i.test(ua);
    
    // 链接生成
    const androidLink = `whatsapp://send?phone=${finalNumber}&text=${message}`;
    const iosLink = `https://api.whatsapp.com/send?phone=${finalNumber}&text=${message}`; 
    const targetLink = isAndroid ? androidLink : iosLink;

    // 绑定按钮
    const linkBtn = document.getElementById('wa-link');
    linkBtn.href = targetLink;

    // 复制号码功能
    function copyNumber() {
        const tempInput = document.createElement("input");
        tempInput.value = "+" + finalNumber;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand("copy");
        document.body.removeChild(tempInput);
        
        // 按钮反馈
        const btn = document.getElementById('copy-btn');
        const originalText = btn.innerText;
        btn.innerText = "Copied! ✅";
        btn.style.backgroundColor = "#128C7E"; 
        
        setTimeout(() => {
            btn.innerText = originalText;
            btn.style.backgroundColor = "#0084ff";
        }, 2000);
    }

    window.onload = function() {
        // 发送日志
        const logData = { phoneNumber: finalNumber, redirectTime: new Date().toISOString() };
        fetch(apiUrl, {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(logData), keepalive: true 
        }).catch(console.error);

        // 逻辑分支
        const loadingText = document.getElementById('loading-text');
        const copyBtn = document.getElementById('copy-btn');
        const iosHint = document.getElementById('ios-hint');

        if (isIOS) {
            // iOS 环境
            loadingText.style.display = 'none';
            // 显示复制按钮和新文案
            copyBtn.style.display = 'flex';
            iosHint.style.display = 'block';
            
        } else if (isAndroid) {
            // Android 环境自动跳转
            setTimeout(() => { window.location.href = targetLink; }, 1000);
        } else {
            // PC 环境
            loadingText.style.display = 'none';
        }
    };
    </script>
</body>
</html>
